# ПРОЕКТ 6. ВЫБИРАЕМ АВТО ВЫГОДНО

Григорьева Людмила, Гиль Юлия
Группа DSPR-28


# ЗАДАЧА

Вы работаете в компании, которая занимается продажей автомобилей с пробегом в Москве. Основная задача компании и её менеджеров — максимально быстро находить выгодные предложения (проще говоря, купить ниже рынка, а продать дороже рынка). 

Руководство компании просит вашу команду создать модель, которая будет предсказывать стоимость автомобиля по его характеристикам.

Если такая модель будет работать хорошо, то вы сможете быстро выявлять выгодные предложения (когда желаемая цена продавца ниже предсказанной рыночной цены). Это значительно ускорит работу менеджеров и повысит прибыль компании.

Проблематика: исторически сложилось, что компания изначально не собирала данные. Есть только небольшой датасет с историей продаж за короткий период, которого для обучения модели будет явно мало. Его будем использовать для теста, остальное придется собрать самим.

Дополнительно:
- Разрешено использовать внешние данные, но их источник должен быть публичным и доступен всем участникам соревнования (auto.ru).
- Разрешено использовать любые ML алгоритмы и библиотеки (кроме DL).
- Даже если удасться найти исходные объявления из теста - нельзя просто указать их цену. Делаем реальный ML продукт, который потом сможет нормально работать на новых данных.

Метрика оценки качества модели: MAPE - средний абсолютный процент ошибки или средняя относительная ошибка прогноза (Mean Absolute Percentage Error).


# СТРУКТУРА ФАЙЛОВ

1. Ноутбук с решением:
    - [[SF-DST Car Price Prediction] EDA and Modelling DSPR-28.ipynb](https://github.com/juliiik/SF_DSPR_28_Gil/blob/main/module_6/%5BSF-DST%20Car%20Price%20Prediction%5D%20EDA%20and%20Modelling%20DSPR-28%20.ipynb) - основная работа по EDA, моделированию
    - [[SF-DST Car Price Prediction] Parsing Data DSPR-28.ipynb](https://github.com/juliiik/SF_DSPR_28_Gil/blob/main/module_6/%5BSF-DST%20Car%20Price%20Prediction%5D%20Parsing%20Data%20DSPR-28.ipynb) - работа по парсингу новых данных с auto.ru
    - [requirements.txt](https://github.com/juliiik/SF_DSPR_28_Gil/blob/main/module_6/requirements.txt) - версии окружения.
2. Данные:
    - [all_auto_ru_09_09_2020.csv](https://github.com/juliiik/SF_DSPR_28_Gil/blob/main/module_6/all_auto_ru_09_09_2020.csv) - исходный датасет
    - [all_car_27_08_2021_data_12_brands.csv](https://github.com/juliiik/SF_DSPR_28_Gil/blob/main/module_6/all_car_27_08_2021_data_12_brands.csv) - новые данные
    - [sample_submission.csv](https://github.com/juliiik/SF_DSPR_28_Gil/blob/main/module_6/sample_submission.csv) - файл для сабмишена
    - [test.csv](https://github.com/juliiik/SF_DSPR_28_Gil/blob/main/module_6/test.csv) - данные для рассчета цены.

Ссылка на Kaggle ноутбук: https://www.kaggle.com/juliagil/sf-dst-car-price-prediction-dspr-28-team

# ОСНОВНЫЕ ВЫВОДЫ

1. Для обогощения данных была проведена работа по **парсингу данных с auto.ru**:
    - код парсинга новых данных доступе в отдельном ноутбуке на Git - [[SF-DST Car Price Prediction] Parsing Data DSPR-28.ipynb](https://github.com/juliiik/SF_DSPR_28_Gil/blob/main/module_6/%5BSF-DST%20Car%20Price%20Prediction%5D%20Parsing%20Data%20DSPR-28.ipynb).
    - по результатам парсинга нами были получены данные для обучающего датасета в размере `137685` записей
    - Путь к файлу: Kaggle: ../input/autorucars/all_car_27_08_2021_data_12_brands.csv [Github](https://github.com/juliiik/SF_DSPR_28_Gil/blob/main/module_6/all_car_27_08_2021_data_12_brands.csv)

2. В ходе **EDA** были совмещены старые и новые данные для обучения с auto.ru, проведена очистка и унификация данных, обработка пустых значений, дубликатов, проведен минимально достаточный отбор признак с помощью корреляционного анализа. Были созданы новые признаки:
    - `km_per_year` - показывает, сколько км в год проезжал автомобиль. Вычисляется, как `mileage`/`productionDate`(years) или `mileage`/`ownershipTime`. Решить, какой метод использовать
    - `carNovelty` - показывает, через сколько лет после выхода модели был выпущен автомобиль, т.е. modelDate - productionDate. 
    - `rarity - признак, показывающий, что автомобиль раритетный (ему более 30 лет)
    - `prodDate_3Y` - признак, что автомобилю уже 3 года
    - `prodDate_5Y` - признак, что автомобилю уже 5 лет
    - `newCar` - признак для обозначения новых авто, пробег равен 0
    - `descriptionIsNull` - признак, показывающий наличие или отсутствие объясления
    - `ownershipTimeIsNull` - показывает, заполнено ли время владения авто: 1 - не заполнено, 0 - заполнено
    - `colorPopular` - признак для обозначения, что авто популярного цвета: 1 - популярного, 0 - непопулярного
    - `brandPopular` - признак для обозначения, что авто популярной марки: 1 - популярного, 0 - непопулярного
    - `modelPopular` - признак для обозначения, что авто популярной модели в рамках бренда: 1 - популярного, 0 - непопулярного.

3. По результатам **моделирования** наилучшую метрику MAPE на наших данных показывали модели на основе "деревьев" и бустинг. 
    - С помощью Lazy Predict смогли отобрать 5-ку наилучших моделей, на которых проводили дальнейшие эксперименты. 
    - Наиболее лучшие значения этой метрики были у следующих моделей:
        - `ExtraTreesRegressor` с дефолтными параметрами и значением MAPE=10.95%
        - `Xgboosting, ExtraTreesRegressor+LinearRegression` (модель стекинга с наилучшими моделями и последней линейнок регрессией) значение MAPE=10.98%
        - `XGBRegressor` с параметрами max_depth=12 learning_rate=0.05 и значением MAPE=11.35%
        - В целом стекинг приводит к неплохим результатам, улучшая нашу метрику.  
    - Однако, лучшей моделью для наших данных стала модель `ExtraTreesRegressor` с дефолтными параметрами и значением MAPE=10.95%.
4. Была выполнена **работа в команде**:
    - работали по [плану работ команды](https://docs.google.com/spreadsheets/d/1ZNuAuKiX1eAxQJlAPlvRofNXmlvBpAK3i5o6QDyCOw0/edit?usp=sharing0)
    - технически использовали Github & Google Colab, чаты и звонки
5. Команда по результатам работы на момент 09.09.2021 занимает **14 позицию на leaderboard (10.95%)**.


# ИДЕИ ДЛЯ ДОРАБОТКИ

Дополнительно можно попробовать:
- Feature engineering: 
    - извлечь признаки из комплектации и оборудования, поработать с текстов описаний (NLP)
    - генерация признаков из числовых признаков (A*B, A/B, A+B, ...)
    - добавление признаков из внешних источников (по брендам, моделям, году производства можно обогатить датасет - класс автомобиля, длинна, масса и тд.)
    - в test были модели авто, по которым не было данных в train. Можно добавить данных с других площадок продажи авто или ценами новых авто этих марок.
- Modelling: 
    - больше экспериментов с разным типов encoding-а категориальных переменных. В задаче основные переменные - категориальные, можно попробовать больше экспериментов
    - эксперименты с разными подходами к feature selection
    - попробовать большее количество стакинга моделей.